{% extends "base.html" %}

{% block title %}
  Public Data Portal | {{ ds.name }} - {{ ds.publisher }}
{% endblock %}

{% block content %}

  <div class="block" id="header">
    <h1 class="title">{{ ds.name }}</h1>

    <!-- put subtitle & buttons side-by-side -->
    <div class="columns">
      <div class="column is-half">
        <p>a dataset published by</p><h2 class="subtitle">{{ds.publisher.name }} | {{ ds.region.name }} | {{ ds.region.country_code|upper }}</h2>
      </div>
      <div class="block column is-half has-text-right">
        <button class="button is-primary" aria-haspopup="true" aria-controls="dropdown-menu">
          <span class="icon">
            <i class="fas fa-star" aria-hidden="true"></i>
          </span>
          <span>Save</span>
        </button>
        {# Download dropdown menu #}
          <div class="dropdown is-hoverable">
            <div class="dropdown-trigger">
              <button class="button is-success" aria-haspopup="true" aria-controls="dropdown-menu">
                <span>Download</span>
                <span class="icon is-small">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </div>
            <div class="dropdown-menu" id="dropdown-menu" role="menu">
              <div class="dropdown-content">
                {% for file in files %}
                  <a href="{{ file.url }}" target="_blank" class="dropdown-item">{{ file.get_file_type_display }} {% if file.file_size_mb %} ({{ file.file_size_mb }}MB) {% endif %}</a>
                {% endfor %}
              </div>
            </div>
        </div>
      </div>

    </div>
  </div>

  {% if ds.temporal_collection %}
  <div class="box" id="temporal-collection">
    <p>This dataset is part of the <a href="#">{{ ds.temporal_collection}}</a> collection.</p>
  </div>
  {% endif %}

  <div class="block" id="quality-score">
    {% if ds.quality_score == -1 %}
    <p>Quality Score: quality score not available</p>
    {% else %}
    <p>Quality Score: {{ ds.quality_score }}</p>
    {% endif %}
  </div>

<div class="block">
  <span class="tag"> Tag label </span>
  {% for tag in tags %}
    <span class="tag"> {{ tag }} </span>
  {% endfor %}
</div>

{# tabs for details/metadata/ugc/collections; reorg layout later #}
<div>
  <div class="tabs is-boxed">
    <ul>
      {% for tab in tabs %}
        <li data-tab="{{ tab.id }}" class="{% if forloop.first %}is-active{% endif %}">
          <a>{{ tab.title }}</a>
        </li>
      {% endfor %}
    </ul>
  </div>

  <div id="tab-content">
    <div class="tab-pane is-active" id="details">
      <div class="block">
        <p><strong>Source URL:</strong> <a class="source-link" href="{{ ds.source_url }}">{{ ds.source_url }}</a></p>
        <p><strong title="Timestamp on data provided by publisher..">Published:</strong> {{ ds.upstream_upload_time|date:"Y-m-d" }}</p>
        <p><strong>Publisher</strong>: {{ ds.publisher.name }} ({{ds.publisher.get_kind_display}})</p>
        <p><strong>Region</strong>: {{ ds.region.name }} | {{ ds.region.country_code|upper }}</p>
        <p><strong title="Last time this dataset was updated by our scrapers.">Last scraped:</strong> {{ ds.updated_at|date:"Y-m-d" }}</p>
        <p><strong title="First time this dataset was seen by our scrapers. ">First seen:</strong> {{ ds.created_at|date:"Y-m-d" }}</p>
      </div>
      <div class="block">
        <h4 class="title is-4">Description</h4>
        <p>{{ ds.description }}</p>
      </div>
    </div>
    <div class="tab-pane" id="comments">
      <p>Comments and other UGC can go here?</p>
    </div>
    <div class="tab-pane" id="collections">
      {% if ds.temporal_collection %}
        <div class="button is-info"><a href="#">{{ ds.temporal_collection }}</a></div>
      {% endif %}
      {% for collection in collections %}
        <div class="button"><a href="#">{{ collection.name }}</a></div>
      {% endfor %}
    </div>
  </div>


  <hr>

  <button class="button is-danger" aria-haspopup="true" aria-controls="dropdown-menu">
    <span class="icon">
      <i class="fas fa-warning" aria-hidden="true"></i>
    </span>
    <span>Report Data Issue</span>
  </button>

</div>

{# JS in html file for testing; abstract out later #}
<style>
  .tab-pane {
    display: none;
  }
  .tab-pane.is-active {
    display: block;
  }
  a { color: inherit; }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll(".tabs ul li");
  const panes = document.querySelectorAll(".tab-pane");

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      const target = tab.dataset.tab;

      // remove is-active from all tabs and panes
      tabs.forEach(t => t.classList.remove("is-active"));
      panes.forEach(p => p.classList.remove("is-active"));

      // add is-active to the clicked tab and its pane
      tab.classList.add("is-active");
      document.getElementById(target).classList.add("is-active");
    });
  });
});
</script>

{% endblock %}
