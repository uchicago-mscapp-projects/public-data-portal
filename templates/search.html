{% extends "base.html" %}

{% block title %}
  Public Data Portal
{% endblock %}

{% block content %}

  <div class="block" id="search box">
    <form action="" method="get">
      <div class="field has-addons">
    <div class="control has-icons-left is-expanded">
      <input class="input" type="text" placeholder="Search..." name="query" id="searchInput" value="{{keyword}}">
      <span class="icon is-small is-left">
        <i class="fas fa-search"></i> <!-- Font Awesome search icon -->
      </span>
    </div>
    <div class="control">
      <button class="button is-info" type="submit">Search</button>
    </div>
  </div>
    </form>
  </div>


<!-- <option value="AllFields">All Fields</option>
<option value="LastUpdated">Last Updated</option> sort, not filter
<option value="QualityScore">Quality Score</option> sort, not filter

GOV_NATIONAL = "gn", _("Government - National")
    GOV_STATE = "gs", _("Government - State")
    GOV_LOCAL = "gl", _("Government - Local")
    NGO = "ng", _("Non-Governmental Organization")
    ACADEMIC = "ac", _("Academic")
-->
<!-- Advanced search goes here -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
      const toggleButton = document.getElementById('advsearchtrigger');
      const collapsibleContent = document.getElementById('advsearchpanel');

      toggleButton.addEventListener('click', function() {
        if (collapsibleContent.style.display === 'none') {
          collapsibleContent.style.display = 'block';
        } else {
          collapsibleContent.style.display = 'none';
        }
      });
    });
</script>

<div class="block">
<button id="advsearchtrigger" class="button is-primary" type="button">Advanced Search</button>
<div id="advsearchpanel" class=box style="display: none;">
    <form action="" method="get">
      <!-- <h2>Advanced Search</h2> -->
       <input id="advsearchInput" name="query" type="hidden" value={{keyword}}>
        <div class="columns">
            <div class="column">
                <div class="block">
                    <label>Publisher Name:</label>
                    <input class="input" type="text" placeholder="Publisher Name..." name="PublisherName" id="PublisherName" value="{{ parameters.PublisherName }}">
                </div>
                <!-- <div class="block">
                    <label>Collection Name:</label>
                    <input class="input" type="text" placeholder="Collection Name..." name="CollectionName" id="CollectionName">
                </div> -->
            </div>
            <div class="column">
                <fieldset>
                  <p>
                    <label for="pubtype">Publisher Type:</label>
                    <div class="select is-multiple">
                    <select name="pubtype" id="pubtype" multiple size="5">
                        <option value="gn"
                            {% if gn in parameters.pubtype %}
                            selected {%endif%}>National Government
                        </option>
                        <option value="gs"
                            {% if gs in parameters.pubtype %}
                            selected {%endif%}>State or Regional Government
                        </option>
                        <option value="gl"
                            {% if gl in parameters.pubtype %}
                            selected {%endif%}>Local Government
                        </option>
                        <option value="ng"
                            {% if ng in parameters.pubtype %}
                            selected {%endif%}>Non-Governmental Organization
                        </option>
                        <option value="ac"
                            {% if ac in parameters.pubtype %}
                            selected {%endif%}>Academic
                        </option>
                    </select>
                  </p>
                </fieldset>
            </div>
        <div class="column">
            <fieldset>
                  <p>
                    <label for="region">Geographic Region:</label>
                    <div class="select is-multiple">
                    <select name="region" id="region" multiple size="4">
                    {% for geo in geographies %}
                        <option value={{geo}}
                            {% if geo in parameters.region %}
                            selected {%endif%}>{{geo}}
                        </option>
                    {% endfor %}
                    </select>
                </p>
            </fieldset>
        </div>
        <div class="column">
            <fieldset>
            <p>
                <label for="filetype">File Type:</label>
                <div class="select is-multiple">
                <select name="filetype" id="filetype" multiple size="4">
                    {% for type in filetypes %}
                        <option value={{type}}
                            {% if type in parameters.filetype %}
                            selected {%endif%}>{{type}}
                        </option>
                    {% endfor %}
                </select>
                </div>
            </p>
            </fieldset>
        </div>
            </div>
          <p>
        <div class="adv-submit">
        <input class="button is-primary is-small" type="reset" value="Clear">
        <input class="button is-info is-small" type="submit" value="Search">
        </div>
      </p>

    </form>
</div>
</div>

  <div class="block">
  <div id="search start">
  <h2>Search Results:</h2>
  </div>

  <div id="n_results"> {# in HTML id is optional, naming the div for future reference #}
  <h2>{{n_results}} results found for <b>datasets</b> containing the keyword "{{keyword}}".
  </h2>
  </div>
  </div>

  {% for dset in page %}
  <div class="box">
    <p>
        <b>
            <a href="http://127.0.0.1:8000/dataset/{{dset.pk}}/">{{ dset.name }}</a>
        </b>
    </p>
    <p>Published by {{ dset.publisher }}</p>
    <p>Last updated {{ dset.upstream_upload_time|date:"F j, Y" }}</p>
  </div>
  {% endfor %}

  <div class="field">
    <label class="label">Results per page:</label>
    <div class="control">
      <div class="select">
        <select id="resultsPerPage">
          <option value="10">10</option>
          <li>
            <a href="?limit=25&page=1" class="dropdown-item"> 10 </a>
          </li>
          <option value="25">25</option>
            <a href="?limit=25&page={{ page.number }}" class="dropdown-item"> This is a link </a>
          <option value="50">50</option>
            <a href="?limit=50&page={{ page.number }}" class="dropdown-item"> This is a link </a>
          <option value="100">100</option>
            <a href="?limit=100&page={{ page.number }}" class="dropdown-item"> This is a link </a>
        </select>
      </div>
    </div>
  </div>

  <nav class="pagination" role="navigation" aria-label="pagination">
  {% if page.has_previous %}
    <a href="{{ uri }}&page={{ page.previous_page_number }}" class="pagination-previous">Previous</a>
  {% endif %}
  {% if page.has_next %}
    <a href="{{ uri }}&page={{ page.next_page_number }}" class="pagination-next">Next page</a>
  {% endif %}
  <ul class="pagination-list">
    {% if page.has_previous %}
    <li>
      <a href="{{ uri }}&page=1" class="pagination-link" aria-label="Goto page 1">1</a>
    </li>
      {% if page.number > 2 %}
        <li>
        <span class="pagination-ellipsis">&hellip;</span>
        </li>
        <li>
        <a href="{{ uri }}&page={{ page.previous_page_number }}" class="pagination-link" aria-label="Goto previous page">{{page.previous_page_number}}</a>
        </li>
      {% endif %}
    {% endif %}
    <li>
      <a
        class="pagination-link is-current"
        aria-label="Page {{page_num}}"
        aria-current="page"
        >{{page.number}}</a
      >
    </li>
    {% if page.has_next %}
      {% if page.paginator.num_pages > page.next_page_number %}
        <li>
        <a href="{{ uri }}&page={{ page.next_page_number }}" class="pagination-link" aria-label="Goto page {{page.next_page_number}}">{{page.next_page_number}}</a>
        </li>
        <li>
        <span class="pagination-ellipsis">&hellip;</span>
        </li>
      {% endif %}
    <li>
      <a href="{{ uri }}&page={{ page.paginator.num_pages }}" class="pagination-link" aria-label="Goto last page">{{page.paginator.num_pages}}</a>
    </li>
    {% endif %}
  </ul>
</nav>

{% endblock %}